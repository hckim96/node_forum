<!DOCTYPE html>
<html lang="en">

<head>
  <!-- <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css"> -->

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <link rel="stylesheet" href="../stylesheets/style.css">

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>

</head>

<body  class="mx-auto b-5" style="">
  <%- include('components/navbar.ejs') %>

  <div class="row justify-content-center" style="padding : 3% 5rem 0% 5rem; max-width: 1920px; margin: auto;">
      <div class=" m-auto" style="width: 100%;">
        <article class="article">
          <div class="article-img">
            <!-- <img src="https://www.bootdey.com/image/800x350/87CEFA/000000" title="" alt=""> -->
          </div>
          <div class="article-title">
            <h6><a href="#">Lifestyle</a></h6>
            <h2 class="text-black">
              <%= post.title %>
            </h2>
            <div class="media">
              <div class="avatar">
                <a href="/profile/<%=post.author.id%>"><img src="/asset/defaultProfile.png" title="" alt=""></a> 
              </div>
              <div class="media-body">
                <div class="row">

                  <div class="col">
                    <label>
                        <a href="/profile/<%=post.author.id%>" style="color: inherit;">
                        <%= post.author.id %>
                        </a>
                    </label>
                    <span>
                      <!-- <%= post.createdAt %> -->
                      <%= moment(post.createdAt).format('llll') %>
                      (
                        <%= moment(post.createdAt).fromNow() %>
                      )
                    </span>
                  </div>
                  <div class="col-md-auto">
                    <span> 조회수 <%= post.view %> </span>
                  </div>
                </div>
                <div class="row ">
                  <div class="col">
                  </div>
                    <% if (post.author.id == userId) { %>
                      <a class="col-md-auto d-block btn btn-link" href="/edit/<%= post.id%>" style="">
                        수정
                      </a>
                      <form class="col-md-auto" action="/post/<%=post.id%>?_method=DELETE" method="post"> 
                        <button class="btn btn-link" type="submit" style="color: red;">
                          삭제
                        </button>
                      </form>
                  <% } %>
                </div>
              </div>
            </div>
          </div>

          <div class="article-content">
            <!-- <%= post.body %> -->
            <% for (const line of post.body.split("\n")) { %>
              <p><%= line %></p>
            <% } %>
          </div>
          <div class="nav tag-cloud">
            <!-- <a href="#">Design</a>
                <a href="#">Development</a>
                <a href="#">Travel</a>
                <a href="#">Web Design</a>
                <a href="#">Marketing</a>
                <a href="#">Research</a>
                <a href="#">Managment</a> -->
          </div>
        </article>



        <!-- <div class="contact-form article-comment">
          <h4>Leave a Comment</h4>
          <form id="contact-form" method="POST">
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <input name="Name" id="name" placeholder="Name *" class="form-control" type="text">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <input name="Email" id="email" placeholder="Email *" class="form-control" type="email">
                </div>
              </div>
              <div class="col-md-12">
                <div class="form-group">
                  <textarea name="message" id="message" placeholder="Your message *" rows="4"
                    class="form-control"></textarea>
                </div>
              </div>
              <div class="col-md-12">
                <div class="send">
                  <button class="px-btn theme"><span>Submit</span> <i class="arrow"></i></button>
                </div>
              </div>
            </div>
          </form>
        </div> -->

        <!-- comment part -->
        <div>
          <div class="comment-write-part">
            <% var commentCnt = post.commentList?.length ?? 0; 
                if (post.commentList) 
                  for (var comment of post.commentList) {
                    if (comment.deleted) commentCnt--;
                    commentCnt += comment.commentList?.length ?? 0;
                  }
            %>
            <h4> <%=commentCnt%>개의 댓글</h4>
            <form action="/comment" method="post">
              <textarea class="w-100 p-2 font-large" placeholder="댓글을 작성하세요" style="height: 10rem;" name="body" required=""></textarea>
              <input hidden="" name="parentModel" value="Post">
              <div class="d-flex justify-content-end my-1">
                <button class="btn btn-primary" type="submit" name="parent" value="<%=post._id%>">댓글 작성</button>
              </div>
            </form>
          </div>

          <div class="comment-list-part mb-5">
            <% for( let index = 0; index < post.commentList.length; index++ ) { %>
              <%- include('components/comment.ejs', {comment: post.commentList[index], idx: index}) %>
            <% } %>
          </div>

        </div>
      </div>
    </div>
</body>
</html>

<!------ Include the above in your HEAD tag ---------->